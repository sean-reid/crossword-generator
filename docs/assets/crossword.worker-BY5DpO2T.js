let o=null;self.onmessage=async e=>{const{type:t,payload:s}=e.data;try{switch(t){case"INIT":await n();break;case"GENERATE":await r(s.size);break;case"CANCEL":self.postMessage({type:"ERROR",payload:{message:"Generation cancelled"}});break;default:self.postMessage({type:"ERROR",payload:{message:`Unknown message type: ${t}`}})}}catch(a){self.postMessage({type:"ERROR",payload:{message:a instanceof Error?a.message:String(a)}})}};async function n(){try{self.postMessage({type:"PROGRESS",payload:{stage:"Loading WASM module",percent:0}});let e;try{e=await import("./crossword_core-CFJreYa9.js")}catch{e=await import("./crossword_core-CFJreYa9.js")}self.postMessage({type:"PROGRESS",payload:{stage:"Initializing WASM runtime",percent:25}}),typeof e.default=="function"&&await e.default(),o=e,self.postMessage({type:"PROGRESS",payload:{stage:"Loading dictionary",percent:50}});const t=e.initialize();self.postMessage({type:"READY",payload:{dictionaryStats:t}})}catch(e){throw console.error("WASM initialization error:",e),new Error(`Failed to initialize WASM: ${e instanceof Error?e.message:String(e)}`)}}async function r(e){if(!o)throw new Error("WASM module not initialized");self.postMessage({type:"PROGRESS",payload:{stage:"Analyzing...",percent:5}}),await new Promise(s=>setTimeout(s,50));const t=o.estimate_problem_size(e);self.postMessage({type:"ESTIMATE",payload:{encoding_ms:t.encoding_ms,solving_ms:t.solving_ms}}),await new Promise(s=>setTimeout(s,50)),self.postMessage({type:"PROGRESS",payload:{stage:"Encoding...",percent:10}});try{const s=o.encode_problem(e);self.postMessage({type:"ENCODING_COMPLETE",payload:{encoding_time_ms:s.encoding_time_ms,estimated_solve_ms:s.estimated_solve_ms}}),await new Promise(i=>setTimeout(i,100));const a=o.solve_problem();self.postMessage({type:"PROGRESS",payload:{stage:"Complete!",percent:100}}),self.postMessage({type:"SUCCESS",payload:{puzzle:a}})}catch(s){throw console.error("Generation error:",s),new Error(`Failed to generate crossword: ${s instanceof Error?s.message:String(s)}`)}}
